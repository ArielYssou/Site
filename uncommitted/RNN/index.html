<!DOCTYPE html>
<html lang='en'>
	<head>

		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, intial-scale=1">

		<!-- Name on tab -->
		<title>LSTM</title>

		<!-- Google Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Cormorant+Garamond:400,700&display=swap" rel="stylesheet"> 

		<!-- Custom CSS -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<link rel="stylesheet" href="../../css/prism.css"> <!--TARGET-->
		<link rel="stylesheet" href="../../css/style.css"> <!--TARGET-->
    <link href="../../css/pygments/notebook/colorful.css" rel="stylesheet">



		<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
		<script src="https://cdn.jsdelivr.net/npm/p5@0.10.2/lib/p5.js"></script>

		<!-- Custom p5js animations -->
		<script src="sketch.js"></script>

	</head>

	<body style="background-color:#42403b">
		<!-- Navigation bar -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
			<a class="navbar-brand" href="../.." style="font-weight:bold;">Ariel Yssou</a> <!--TARGET-->
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item">
						<a class="nav-link" href="../.." style="font-weight:bold;">Home</a><!--TARGET-->
 
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="../../blog" style="font-weight:bold;">Blog <span class="sr-only">(current)</span></a><!--TARGET-->
					</li>
					<li class="nav-item">
						<a class="nav-link" href="../../about" style="font-weight:bold;">About</a><!--TARGET-->
					</li>
				</ul>
			</div>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item">
						<a class="nav-link text-nowrap" href="https://github.com/ArielYssou" target="_blank"><i class="fab fa-github fa-lg"></i></a>
					</li>
					<li class="nav-item">
						<a class="nav-link text-nowrap" href="https://www.linkedin.com/in/ariel-yssou-oliveira-f-2a07a5b5/" target="_blank"><i class="fab fa-linkedin fa-lg"></i></a>
					</li>
				</ul>
			</div>
		</nav>
		<!-- End of navigation bar -->
		
		<div class="container post_body">
			<div class="row post_struct">
				<div class="col-ld-12">
					<div class="post_cover">
						<div class="blog_title">
							LTSM
						</div>
					</div>

					<p> In this post we will tackle the task of time series forecasting with <b>Long Short Term Memory (LSTM)</b> neural networks using the "Historical Hourly Weather Data 2012-2017" dataset. The task of predicting the weather is a challenging one, more so without using any specific models or insights from know meteorological models, but we will try to approach this problem armed only with machine learning! The methods that we are going to discuss are not limited to time series but could be applied to any sequential data, such as text (in fact LTSM is vastly used in Natural Language Processing (NLP) tasks).</p>
					<!-- TOC -->
					<h2>Index</h2>
					<a href="#RNN">Recurrent Neural Networks</a>	<br>
					<a href="#LSTM">Long Short Term Memory</a>	<br>
					<a href="#CODE">Implementation</a>	<br>

					<!-- Intro -->
					<a name="RNN"></a>
					<h2>Recurrent Neural Networks</h2>
					<p>Our task is to construct a model that is able to predict the future of a given sequence of events, that we will denote as $x_0, x_1, \dots, x_t$. Our first guess might be to use a "traditional" neural network such as this:</p>
					<!--NN scheme-->
					<p>While effective this type of architecture does not exploit the sequential nature of the data and thus wields poor generalization. The key feature that these networks miss is some sort of "memory" (a term that we will use casually throughout this text). Indeed, at step $t$ the state $h_t$ of a neuron in the hidden layer can be written as:
					\(
					\begin{equation}
					h_t = f(\mathbb{w}_t \dot \mathbb{x}_t),
					\end{equation}\)
					where $\mathbb{w}_t$ are weights (bias is omitted for simplicity) and $f$ a generic activation function. The is no explicit dependence to any sort of past data, as they would only affect the way the weights are trained (thus becoming prune to be extremely susceptible to the starting point of the data sequence). This could be solved by introducing an explicit dependence on the past state of the neuron:
					\(
					\begin{equation}
					h_t = f(\mathbb{w}_t \dot \mathbb{x}_t + \mathbb{u}_t \dot \mathbb{h}_{t-1}),
					\end{equation}\)
					where\$mathbb{u}_t$ is a new set of parameters that control how much of the past information (or "memory") is used. This transforms the expression of the state of the neuron into a <i>recurrence</i> relation. This kind of rational lead to the formulation of <b>Recurrent Neural Networks (RNN)</b> (not to be confused with <i>Recursive neural nets</i> that share the same acronym and sound similar, but are vastly different as you can read here). As the hidden units use their own past output to proceed, the same parameters are used over and over again. This <i>parameter sharing</i> can be loosely interpreted as the network keeping what it has already leaned previously and is one of the reasons why RNN are best suited for sequential data. The structure of a RNN can be illustrated as:</p>
					<!-- rnn SCHEME -->
					<p>The representation on the right is know as the <i>unfolded</i> computational graph of a RNN, which is just a fancy name of expanding a recurrence relation. As each state necessarily requires the previous, this kind of scheme cannot be parallelized. Modifications, such as not using the previous state but only its output, can improve parallelization (you can read more about RNN variants and parallelization details here (book deep learning). In fact RNN is a vast family of models, each doing the recurrence in a slightly different way.</p>
					 <!-- Application on the dataset -->
					<!-- Conclusion RNN -->
					<p>"Vanilla" RNN improve on the baseline model, but have their limitations. Although there is no theoretical limit to a RNN memory, it can be show that its hard to learn long term dependencies with RNNs (see <a href = "https://ieeexplore.ieee.org/document/279181">Bengio <i>et al</i></a>) as their effects are heavily "diluted" as the recurrence is iterated. This limitation arises from the recurrence itself as the network is as deep as the length of the sequence and thus the same weights are used several times. If we were dealing, for example, with a time series of 100 steps; the recurrence will apply the same weights 100 times, thus the final state $h_{100}$ will depend on the weight matrix $W^{100}$. The gradients (used in gradient descent) linked to eigenvalues slightly different than 1 will wither vanish or explode, thus making training a hard task. <b>LSTM</b> is one popular RNN model that tackles this problem and is specially built to deal with both long and short term dependencies.</p>
					<!-- LTSM -->
					<a name="LSTM"></a><h2>Long Short Term Memory</h2>
					<p>LSTM addresses the problem of long term memory by making several modifications to the vanilla RNN architecture. Indeed its structure is far more complex:</p>
					<!-- LTSM scheme -->
					<p>I cannot even dream of writing a better explanation on LSTMs than Colah in his amazing blog post, but I'll try to explain then in a different way.</p>

					<p>The idea is to combine a short memory term with a long memory term
					$$h_t = ("Short memory") \times ("Long memory") \equiv S_t + L_t.$$
					<p>The short memory term $S_t$ will only combine the input with the very last state of the cell. This short memory will be learned via a usual neural net layer with a $\sigma$ activation function.
					$S_t = \sigma ( w_s [h_{t-1}, x_t] + b_s ),$$
					where $w_s$ and $b_s$ are the weights and bias of this layer. The long memory term $L_t$ will be responsible of carrying the memory of the cell, forgetting any currently held information (old information") and adding new information based on the current input and state. We can think of it like:</p>
					$$L_t = ("Forget rate") . ("Old information") + ("acceptance rate") . ("New information") \equiv f_t L_{t-1} + a_t + \overtilde{L}_{t-1}.$$
					<p>The old information is the last value of the memory, that is equivalent to $L_{t-1}$. Both the "forget rate" $f_t$ , "acceptance rate" $a_t$ and "new information" $\overtilde{L}_t$ must be learned. This is done via a usual neural net layers:
					$$\begin{eqnarray*}
					f_t &= \sigma ( w_f [h_{t-1}, x_t] + b_f ),\\
					a_t &= \sigma ( w_a [h_{t-1}, x_t] + b_a ),\\
					\overtilde{L}_t &= \tanh ( w_l [h_{t-1}, x_t] + b_l ),\\
					\end{eqnarray*}$$
					where all the $w$ are separate sets of weights and $b$ the biases that need to be learned. In order to "smoothly normalize" the long memory term (as it can exceed unity as its is the sum of two things that can be at maximum 1) the LSTM model applies a $tanh$ to it. This leads us to the final form of the state of the LSTM cell:</p>
					$$\boxed{h_t = S_t \tanh(L_t)}.$$
					<a name="CODE"></a><h2>Implementation</h2>
					{% include 'weather.html' %}

					
					<div class="sketch-holder" id="c1"></div><br>
					<p> Lorem ipsum </p>
					<div class="sketch-holder" id="c2"></div>
					
					Code:
					<pre data-src="sketch.js" class="line-numbers my_code"></pre>
<div class="highlight"><pre><span></span><span class="c1">// ############################################################</span>
<span class="kd">function</span> <span class="nx">Node</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">facecolor</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">edgecolor</span> <span class="o">=</span> <span class="s2">&quot;#ffffff&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// A constructor function for regular neurons representaed by circles</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">pos</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">radius</span> <span class="o">=</span> <span class="nx">radius</span><span class="p">;</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">facecolor</span> <span class="o">=</span> <span class="nx">facecolor</span><span class="p">;</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">edgecolor</span> <span class="o">=</span> <span class="nx">edgecolor</span><span class="p">;</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">push</span><span class="p">();</span>
		<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">facecolor</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">p</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">facecolor</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">p</span><span class="p">.</span><span class="nx">noFill</span><span class="p">();</span>
		<span class="p">}</span>

		<span class="nx">p</span><span class="p">.</span><span class="nx">stroke</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">edgecolor</span><span class="p">);</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">ellipse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">radius</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">radius</span><span class="p">);</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
	<span class="p">};</span>

<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Layer</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">total_nodes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// DOCSTRING</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">pos</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">width</span><span class="p">;</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">height</span><span class="p">;</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">total_nodes</span> <span class="o">=</span> <span class="nx">total_nodes</span><span class="p">;</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">nodes</span> <span class="o">=</span> <span class="p">[];</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">show</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Dense</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">total_nodes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// DOCSTRING</span>
	<span class="nx">Layer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">total_nodes</span><span class="p">);</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">radius</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">total_nodes</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">radius</span><span class="p">)</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">radius</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.95</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">total_nodes</span><span class="p">);</span>
	<span class="p">};</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">center</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">radius</span><span class="p">;</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">offset</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="p">(</span><span class="nx">total_nodes</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">radius</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="nx">total_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">nodes</span> <span class="o">=</span> <span class="p">[];</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">input_anchors</span> <span class="o">=</span> <span class="p">[];</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">output_anchors</span> <span class="o">=</span> <span class="p">[];</span>

	<span class="kd">let</span> <span class="nx">posy</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">radius</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">offset</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">total_nodes</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Node</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">posy</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">radius</span><span class="p">));</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">input_anchors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">radius</span><span class="p">,</span> <span class="nx">posy</span><span class="p">));</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">output_anchors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">radius</span><span class="p">,</span> <span class="nx">posy</span><span class="p">));</span>
		<span class="nx">posy</span> <span class="o">+=</span>  <span class="mi">2</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">radius</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">offset</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Network</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">layers</span> <span class="o">=</span> <span class="p">[];</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">layer</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">layer</span><span class="p">);</span> <span class="c1">// Add check</span>
	<span class="p">}</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">draw_connections</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">push</span><span class="p">();</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">strokeWeight</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">stroke</span><span class="p">(</span><span class="s1">&#39;#F&#39;</span><span class="p">)</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">layer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">layer</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">layer</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">pos1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">pos1</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">[</span><span class="nx">layer</span><span class="p">].</span><span class="nx">output_anchors</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">pos1</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">pos2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">pos2</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">[</span><span class="nx">layer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="nx">input_anchors</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">pos2</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">p</span><span class="p">.</span><span class="nx">line</span><span class="p">(</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">[</span><span class="nx">layer</span><span class="p">].</span><span class="nx">output_anchors</span><span class="p">[</span><span class="nx">pos1</span><span class="p">].</span><span class="nx">x</span><span class="p">,</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">[</span><span class="nx">layer</span><span class="p">].</span><span class="nx">output_anchors</span><span class="p">[</span><span class="nx">pos1</span><span class="p">].</span><span class="nx">y</span><span class="p">,</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">[</span><span class="nx">layer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="nx">input_anchors</span><span class="p">[</span><span class="nx">pos2</span><span class="p">].</span><span class="nx">x</span><span class="p">,</span>
						<span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">[</span><span class="nx">layer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="nx">input_anchors</span><span class="p">[</span><span class="nx">pos2</span><span class="p">].</span><span class="nx">y</span><span class="p">,</span>
						<span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">draw_connections</span><span class="p">();</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">layers</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">show</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">p</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// p could be any variable name</span>
	<span class="kd">var</span> <span class="nx">nn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Network</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
	<span class="nx">nn</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="k">new</span> <span class="nx">Dense</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="p">);</span>
	<span class="nx">nn</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="k">new</span> <span class="nx">Dense</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="p">);</span>
	<span class="nx">nn</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="k">new</span> <span class="nx">Dense</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="p">);</span>
	<span class="nx">nn</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="k">new</span> <span class="nx">Dense</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">);</span>

  <span class="nx">p</span><span class="p">.</span><span class="nx">setup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="c1">//var myWidth = document.getElementById(&quot;c1&quot;).offsetWidth;</span>
		<span class="cm">/* var myHeight = document.getElementById(&quot;c1&quot;).offsetHeight; */</span>
    <span class="nx">p</span><span class="p">.</span><span class="nx">createCanvas</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">p</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">p</span><span class="p">.</span><span class="nx">background</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
		<span class="nx">nn</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">noLoop</span><span class="p">()</span>
  <span class="p">};</span>

	<span class="nx">p</span><span class="p">.</span><span class="nx">windowResized</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">mwidth</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;c1&quot;</span><span class="p">).</span><span class="nx">offsetWidth</span><span class="p">;</span>
		<span class="cm">/*mheight = document.getElementById(&quot;c1&quot;).offsetHeight;*/</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">resizeCanvas</span><span class="p">(</span><span class="nx">mwidth</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

		<span class="c1">// Don&#39;t forget to resize all positions as well</span>
		<span class="nx">x</span> <span class="o">=</span> <span class="nx">mwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">myp51</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">p5</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="s1">&#39;c1&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">BlobsCloud</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">clr</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">)</span> <span class="p">{</span> 
	<span class="k">this</span><span class="p">.</span><span class="nx">pos</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">clr</span> <span class="o">=</span> <span class="nx">clr</span><span class="p">;</span>

	<span class="kd">let</span> <span class="nx">max_width</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span> <span class="c1">// Max width of ellipses composing the cloud </span>
	<span class="kd">let</span> <span class="nx">min_width</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span> <span class="c1">// Min width of ellipses composing the cloud </span>
	<span class="kd">let</span> <span class="nx">max_height</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span> <span class="c1">// Max height of ellipses composing the cloud </span>
	<span class="kd">let</span> <span class="nx">min_height</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span> <span class="c1">// Min height of ellipses composing the cloud </span>

	<span class="kd">let</span> <span class="nx">spread_x</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
	<span class="kd">let</span> <span class="nx">spread_y</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

	<span class="kd">let</span> <span class="nx">nblobs</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">//Number of ellipses (blobs)</span>

	<span class="c1">//Creates the cloud</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">blobs</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">nblobs</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">blobs</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
			<span class="nx">pos</span><span class="o">:</span> <span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span>
				<span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="o">-</span><span class="nx">spread_x</span><span class="p">,</span> <span class="nx">spread_x</span><span class="p">),</span>
				<span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="o">-</span><span class="nx">spread_y</span><span class="p">,</span> <span class="nx">spread_y</span><span class="p">)</span>
			<span class="p">),</span>
			<span class="nx">a</span><span class="o">:</span> <span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">min_width</span><span class="p">,</span> <span class="nx">max_width</span><span class="p">),</span>
			<span class="nx">b</span><span class="o">:</span> <span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">min_height</span><span class="p">,</span> <span class="nx">max_height</span><span class="p">),</span>
		<span class="p">});</span>
	<span class="p">}</span>

	<span class="c1">// Geometric center of the cloud</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">center</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">blobs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">blobs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">pos</span><span class="p">);</span>
	<span class="p">};</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">center</span><span class="p">.</span><span class="nx">div</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">blobs</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
	

	<span class="k">this</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">push</span><span class="p">();</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">blobs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">blobs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
			<span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">blobs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
			<span class="nx">p</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
			<span class="nx">p</span><span class="p">.</span><span class="nx">noStroke</span><span class="p">();</span>
			<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">blobs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">a</span><span class="p">)</span>
			<span class="nx">p</span><span class="p">.</span><span class="nx">ellipse</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">blobs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">a</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">blobs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">b</span><span class="p">);</span>
		<span class="p">};</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
	<span class="p">}</span>

<span class="p">}</span>

<span class="kd">function</span> <span class="nx">BezierCloud</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">clr</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">pos</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">clr</span> <span class="o">=</span> <span class="nx">clr</span><span class="p">;</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">len</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span> <span class="c1">// Flat base</span>
	<span class="c1">//let anchors = p.random(5,10); // Number of anchors</span>
	<span class="kd">let</span> <span class="nx">anchors</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="c1">// Number of anchors</span>

	<span class="kd">let</span> <span class="nx">anchorAngles</span> <span class="o">=</span> <span class="p">[];</span>
	<span class="kd">let</span> <span class="nx">anchorRadius</span> <span class="o">=</span> <span class="p">[];</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">anchors</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">anchorAngles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">p</span><span class="p">.</span><span class="nx">TWO_PI</span><span class="o">/</span> <span class="nx">anchors</span> <span class="o">-</span> <span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">TWO_PI</span> <span class="o">/</span> <span class="mi">10</span><span class="p">));</span>
		<span class="nx">anchorRadius</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">len</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span> <span class="p">);</span>
	<span class="p">}</span>
	<span class="nx">anchorAngles</span><span class="p">.</span><span class="nx">sort</span><span class="p">()</span>
	<span class="kd">let</span> <span class="nx">aux1Angles</span> <span class="o">=</span> <span class="p">[</span><span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">anchorAngles</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
	<span class="kd">let</span> <span class="nx">aux2Angles</span> <span class="o">=</span> <span class="p">[</span><span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">aux1Angles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">anchorAngles</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
	<span class="kd">let</span> <span class="nx">aux1Radius</span> <span class="o">=</span> <span class="p">[</span><span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">anchorRadius</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">anchorRadius</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)]</span>
	<span class="kd">let</span> <span class="nx">aux2Radius</span> <span class="o">=</span> <span class="p">[</span><span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">anchorRadius</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">anchorRadius</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)]</span>

	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">anchors</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">aux1Angles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">anchorAngles</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="nx">anchorAngles</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span>
		<span class="nx">aux2Angles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">aux1Angles</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">anchorAngles</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span>
		<span class="nx">aux1Radius</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">anchorRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">anchorRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">))</span>
		<span class="nx">aux2Radius</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">anchorRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">anchorRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">))</span>
	<span class="p">}</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">anchorAngles</span><span class="p">)</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aux1Angles</span><span class="p">)</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">aux2Angles</span><span class="p">)</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">shape</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">beginShape</span><span class="p">();</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">vertex</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">anchors</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">p</span><span class="p">.</span><span class="nx">bezierVertex</span><span class="p">(</span>
				<span class="mi">2</span><span class="o">*</span><span class="nx">aux1Radius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">p</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">aux1Angles</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span>
				<span class="o">-</span><span class="nx">aux1Radius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">p</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">aux1Angles</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span>
				<span class="mi">2</span><span class="o">*</span><span class="nx">aux2Radius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">p</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">aux2Angles</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span>
				<span class="o">-</span><span class="nx">aux2Radius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">p</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">aux2Angles</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span>
				<span class="mi">2</span><span class="o">*</span><span class="nx">anchorRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">p</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">anchorAngles</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span>
				<span class="o">-</span><span class="nx">anchorRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">p</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">anchorAngles</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
			<span class="p">)</span>
		<span class="p">}</span>
		<span class="c1">//p.vertex(-this.len, 0);</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">endShape</span><span class="p">();</span>
	<span class="p">};</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">push</span><span class="p">();</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">shape</span><span class="p">();</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
	<span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">CartoonCloud</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">clr</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">pos</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">clr</span> <span class="o">=</span> <span class="nx">clr</span><span class="p">;</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">len</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span> <span class="c1">// Flat base</span>
	<span class="kd">let</span> <span class="nx">left_anchor</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>
	<span class="kd">let</span> <span class="nx">left_aux</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span> <span class="o">+</span> <span class="nx">left_anchor</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">left_anchor</span><span class="p">.</span><span class="nx">y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
	<span class="kd">let</span> <span class="nx">right_anchor</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">));</span>
	<span class="kd">let</span> <span class="nx">right_aux</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">createVector</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span> <span class="o">+</span> <span class="nx">right_anchor</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">right_anchor</span><span class="p">.</span><span class="nx">y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

	<span class="kd">let</span> <span class="nx">openning</span> <span class="o">=</span> <span class="nx">right_anchor</span><span class="p">.</span><span class="nx">angleBetween</span><span class="p">(</span><span class="nx">left_anchor</span><span class="p">);</span>

	<span class="kd">let</span> <span class="nx">anchors</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Number of anchors</span>

	<span class="kd">let</span> <span class="nx">anchorAngles</span> <span class="o">=</span> <span class="p">[</span><span class="nx">right_anchor</span><span class="p">.</span><span class="nx">heading</span><span class="p">()];</span>
	<span class="kd">let</span> <span class="nx">anchorRadius</span> <span class="o">=</span> <span class="p">[</span><span class="nx">right_anchor</span><span class="p">.</span><span class="nx">mag</span><span class="p">()];</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">anchors</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">anchorAngles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">anchorAngles</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nx">openning</span><span class="o">/</span><span class="p">(</span><span class="nx">anchors</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>  <span class="o">-</span> <span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">20</span><span class="p">));</span>
		<span class="nx">anchorRadius</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="mf">0.99</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="p">)</span> <span class="p">);</span>
	<span class="p">}</span>
	<span class="nx">anchorAngles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">left_anchor</span><span class="p">.</span><span class="nx">heading</span><span class="p">())</span>
	<span class="nx">anchorRadius</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">left_anchor</span><span class="p">.</span><span class="nx">mag</span><span class="p">())</span>

	<span class="nx">anchorAngles</span><span class="p">.</span><span class="nx">sort</span><span class="p">()</span>
	<span class="kd">let</span> <span class="nx">auxAngles</span> <span class="o">=</span> <span class="p">[</span><span class="nx">right_aux</span><span class="p">.</span><span class="nx">heading</span><span class="p">()]</span>
	<span class="kd">let</span> <span class="nx">auxRadius</span> <span class="o">=</span> <span class="p">[</span><span class="nx">right_aux</span><span class="p">.</span><span class="nx">mag</span><span class="p">()]</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">anchorAngles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">auxAngles</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="nx">anchorAngles</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nx">anchorAngles</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">-</span><span class="nx">anchorAngles</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
		<span class="nx">auxRadius</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">random</span><span class="p">(</span><span class="nx">anchorRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">anchorRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">))</span>
	<span class="p">}</span>

	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">auxAngles</span><span class="p">)</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">anchorAngles</span><span class="p">)</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">shape</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">beginShape</span><span class="p">();</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">vertex</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">anchorAngles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">p</span><span class="p">.</span><span class="nx">quadraticVertex</span><span class="p">(</span>
				<span class="nx">auxRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">p</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">auxAngles</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span>
				<span class="o">-</span><span class="nx">auxRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">p</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">auxAngles</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span>
				<span class="nx">anchorRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">p</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">anchorAngles</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span>
				<span class="o">-</span><span class="nx">anchorRadius</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*</span> <span class="nx">p</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">anchorAngles</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
			<span class="p">)</span>
		<span class="p">}</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">quadraticVertex</span><span class="p">(</span><span class="nx">left_aux</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="o">-</span><span class="nx">left_aux</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">vertex</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">endShape</span><span class="p">();</span>
	<span class="p">};</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">push</span><span class="p">();</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">fill</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">strokeWeight</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">shape</span><span class="p">();</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
	<span class="p">};</span>
<span class="p">}</span>


<span class="c1">// ############################################################</span>
<span class="c1">// Sketch Two</span>
<span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">p</span> <span class="p">)</span> <span class="p">{</span> 
	<span class="c1">//var cloud = new BlobsCloud(p, 100, 100);</span>
	<span class="kd">var</span> <span class="nx">cloud</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CartoonCloud</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

  <span class="nx">p</span><span class="p">.</span><span class="nx">setup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">myWidth</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;c2&quot;</span><span class="p">).</span><span class="nx">offsetWidth</span><span class="p">;</span>
		<span class="cm">/*var myHeight = document.getElementById(&quot;c1&quot;).offsetHeight;*/</span>

    <span class="nx">p</span><span class="p">.</span><span class="nx">createCanvas</span><span class="p">(</span><span class="nx">myWidth</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">p</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">cloud</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">noLoop</span><span class="p">();</span>
  <span class="p">};</span>

	<span class="nx">p</span><span class="p">.</span><span class="nx">windowResized</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">mwidth</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;c2&quot;</span><span class="p">).</span><span class="nx">offsetWidth</span><span class="p">;</span>
		<span class="cm">/*mheight = document.getElementById(&quot;c2&quot;).offsetHeight;*/</span>
		<span class="nx">p</span><span class="p">.</span><span class="nx">resizeCanvas</span><span class="p">(</span><span class="nx">mwidth</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
	<span class="p">};</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">myp52</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">p5</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">);</span>
</pre></div>

				</div>
			</div>
		</div>

		<hr/>
		<script src="../../js/script.js"> </script><!--TARGET-->
		<script src="../../js/prism.js"> </script><!--TARGET-->
		<!-- Bootstrap + JQuery -->
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

		<script src="https://kit.fontawesome.com/9ead9d8df4.js" crossorigin="anonymous"></script>


	</body>
</html>
